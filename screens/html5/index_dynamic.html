<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HTML5 Page</title>
   
    <style>
        /* ضبط الصفحة لتتكيف مع iframe */
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
        
            font-family: Arial, sans-serif;
            box-sizing: border-box; /* لضمان تناسب المحتوى */
        }

        .container {
            display: flex;
            flex-direction: column; /* عرض الصور في صفوف */
            align-items: center; /* محاذاة الصور أفقيًا */
            gap: 5px; /* مسافة بين الصفوف */
            padding: 10px;
            width: 100%;
            height: 100%;
            box-sizing: border-box; /* منع تجاوز المحتوى */
        }

        .image-row {
            display: flex;
            justify-content: start;
            gap: 20px; /* مسافة بين الصور داخل الصف */
            flex-wrap: wrap;
        }

        .image-row img {
           

            width: 300px;
            height: 150px;
            object-fit: cover; /* ضبط تناسب الصور */
        }

        .image-row p {
            font-size: 14px;
            color: white;
            font-weight: 500;
            text-align: center; /* محاذاة النص في المنتصف */
            width: 300px;
        }
.html5Element {
    display: flex;
    justify-content: space-between;
    flex-direction: column;
    align-items: center;
    justify-content: normal;
    border: 1px solid #878787; /* تحديد اللون وسمك الإطار */
    text-align: center;
    font-size: 14px;
    cursor: pointer; 
   
    
    
   
    color: white;
    font-size: 20px;
    border-radius: 10px;
    transition: transform 0.3s ease, box-shadow 0.4s ease;
    overflow: hidden;
    text-transform: uppercase;
    background: linear-gradient(45deg, #ff7e5f, #ffae42);
}

.html5Element:hover {
     transform: translateY(-10px);
      box-shadow: 0 12px 20px rgba(0, 0, 0, 0.3);
      background: linear-gradient(45deg, #ffae42, #ff7e5f);
}



    .iframe-content {
    flex-wrap: wrap;
    width: 100vw;
    display: flex;
    flex-direction: row;
    justify-content: center;
    gap: 20px;
    margin-bottom: 100px;
}

.html5Element {
    width: 200px;
    height: 200px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: normal;
    border: 1px solid #878787;
    text-align: center;
    cursor: pointer;
    color: white;
    font-size: 20px;
    border-radius: 10px;
    transition: transform 0.3s ease, box-shadow 0.4s ease;
    overflow: hidden;
    text-transform: uppercase;
    background: linear-gradient(45deg, #ff7e5f, #ffae42);
}

.html5Element img {
  width: 200px;
}

.html5Element p {
  font-size: 16px;
  font-weight: 500;
  font-family: 'Arial', sans-serif;
  display: flex;
  justify-content: center;
  align-items: center;
  flex-grow: 1;
  text-align: center;
}


.container {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-size: cover;
  gap: 20px;
  padding: 20px 0;
}
</style>



  

    



<script>

const folderPath = '/screens/html5/banners/';
const bannersList = {};

const addbannersList = (setName, setPath) => {
  bannersList[setName] = bannersList[setName] || { setName, setPath, banners: {} };
};

const addBannerTobannersList = (setName, bannerName, bannerPath, bannerWidth, bannerHeight) => {
  if (!bannersList[setName]) {
   // console.log(`Banner set "${setName}" does not exist. Please add it first.`);
    return;
  }
  bannersList[setName].banners[bannerName] = { bannerName, bannerPath, dimensions: { width: bannerWidth, height: bannerHeight } };
};

async function fetchFolders(directoryPath) {
  try {
    const response = await fetch('http://localhost:3001/get-dims', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ path: directoryPath })
    });

    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);

    const data = await response.json();
    if (data && Array.isArray(data.folders)) {
      return data.folders;
    } else {
      throw new Error('Invalid data structure received');
    }
  } catch (error) {
    console.error(`Error fetching folders for path "${directoryPath}":`, error);
    throw error;
  }
}

async function buildBannersList() {
  try {
    const folders = await fetchFolders(folderPath);

    for (const setName of folders) {
      const setPath = `${folderPath}${setName}/`;
      addbannersList(setName, setPath);

      const subfolders = await fetchFolders(setPath);
      for (const bannerName of subfolders) {
        const bsize = bannerName.match(/(\d+)[xX](\d+)$/);
        if (bsize) {
          addBannerTobannersList(setName, bannerName, `${setPath}${bannerName}`, parseInt(bsize[1]), parseInt(bsize[2]));
        } else {
          console.warn(`Banner "${bannerName}" does not match size pattern.`);
        }
      }
    }

   
    return bannersList; // إرجاع الكائن النهائي
  } catch (error) {
    console.error('Failed to build banners list:', error);
    throw error;
  }
}



// استدعاء الدالة الرئيسية
(async () => {
  try {

    const banners = await buildBannersList();
//  console.log(bannersJsonData["HTML5-reveal-demandbase-pipeline-teas"].banners);
    const bannersJsonData = await readJson('output.json'); 
   // console.log(bannersJsonData);
    const divContainer = document.getElementById('container');
    const bannersView = document.getElementById('bannersView');
    let htmlContent = '';
    let htmlSubContent = '';
    htmlContent = '<div class="iframe-content" id="contentContainer">'
    

    // التكرار عبر العناصر وإضافة مستمع للنقر
   

   
    
    for (const setName in banners) {
      //console.log(bannersJsonData[setName].banners);
      const bSet = banners[setName];
      const bsetName = setName.replace(/[_-]|html5/gi, ' ').trim().replace(/\s+/g, ' ');
/*       <div class="html5Elementss" id="${setName}"  onclick=" handleClick(setName)" > */
      htmlContent += `
      
        <div class="html5Element"  id="${setName}" >
        
          <img src="${bSet.setPath}thumb.jpg">
            <p>${bsetName}</p>
      </div>
      
      `;
     


              // results.innerHTML +=`<div id="bSetName">  ${setName}</div>`;
                for (const bannerName in bSet.banners) {
                  const banner = bSet.banners[bannerName];
              
                  htmlSubContent +=`
                  
                  <iframe id="${bannerName}" src="${bSet.setPath+bannerName}" width="${banner.dimensions.width}" height="${banner.dimensions.height}"></iframe>

                  `;
                  
               /*    console.log(`  Banner: ${bannerName}`);
                  console.log(`  Path: ${banner.bannerPath}`);
                  console.log(`  Size: ${banner.dimensions.width}x${banner.dimensions.height}`);
                  divContainer.innerHTML += ``; */
                }



divContainer.innerHTML = htmlContent;
bannersView.innerHTML = htmlSubContent;


}//endfor
createJson (bannersList);
addClickListeners(banners);



  } catch (error) { console.error('Error in main execution:', error); }
})();



 function addClickListeners(x) {
 // console.log(x);
  const divContainer = document.getElementById('container');

  // إضافة مستمع الحدث على العنصر الأب
  divContainer.addEventListener('click', (event) => {
    // التأكد من أن العنصر الذي تم النقر عليه يحتوي على class "html5Element"
    if (event.target.closest('.html5Element')) {
     // console.log(event.target.closest('.html5Element').id);
      

    } else {
     // console.log('Clicked on a non-target element:', event.target);
    }
  });
}



const createJson = (obj) => {
  console.log(obj);




  const data = obj;

const reorderBanners = (banners) => {
  return Object.entries(banners)
    .sort(([keyA, valueA], [keyB, valueB]) => {
      const { width: wA, height: hA } = valueA.dimensions;
      const { width: wB, height: hB } = valueB.dimensions;

      // تحديد الشكل: 1 = عمودي، 2 = مربع، 3 = أفقي
      const getType = (w, h) => {
        const ratio = w / h; // نسبة العرض إلى الطول
        if (ratio < 1) {
          return 1; // عمودي
        } else if (ratio >= 1 && ratio <= 1.2) {
          return 2; // مربع
        } else {
          return 3; // أفقي
        }
      };

      const typeA = getType(wA, hA);
      const typeB = getType(wB, hB);

      if (typeA !== typeB) {
        return typeA - typeB; // ترتيب حسب النوع
      }

      // إذا كان النوع متشابهًا، ترتيب حسب المساحة تنازليًا
      return wB * hB - wA * hA;
    })
    .reduce((acc, [key, value]) => {
      acc[key] = value;
      return acc;
    }, {});
};

// إعادة ترتيب البانرات لكل `set`
Object.keys(data).forEach((setName) => {
  const set = data[setName];
  set.banners = reorderBanners(set.banners);
});

// عرض الناتج





    const jsonString = JSON.stringify(data, null, 2);
    const blob = new Blob([jsonString], { type: 'application/json' });
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = 'output.json'; 

    link.click();






















    
};


const readJson = async (file) => {
  try {
    const response = await fetch(file); // الانتظار حتى تنتهي عملية جلب البيانات
    const data = await response.json(); // الانتظار حتى يتم تحويل الاستجابة إلى JSON
    return data; // إرجاع البيانات
  } catch (error) {
    console.log('Error reading JSON file:', error);
  }
};








</script>




</head>
<body>
  <main class="container" id="maincontainer">
    <div class="container" id="container"></div>
    <div class="bannersView" id="bannersView">

    </div>
  </main>

</body>
</html>
